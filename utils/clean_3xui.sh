#!/bin/bash

# curl -Ls "https://gist.githubusercontent.com/ziz6956/6c51dfaca88e9903d945d1ecb2f5e18f/raw/clean_3xui.sh?v=$(date +%s)" | sudo bash

echo "=========================================="
echo "üßπ –ù–ê–ß–ò–ù–ê–ï–ú –ü–û–õ–ù–£–Æ –û–ß–ò–°–¢–ö–£ 3X-UI"
echo "=========================================="

# 1. –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏ —É–¥–∞–ª—è–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã, –æ–ø–∏—Å–∞–Ω–Ω—ã–µ –≤ docker-compose
if [ -f ~/3x-ui/docker-compose.yml ]; then
    echo "--- [1/5] –£–¥–∞–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ —á–µ—Ä–µ–∑ Docker Compose..."
    cd ~/3x-ui && sudo docker-compose down
else
    echo "--- [1/5] –§–∞–π–ª docker-compose –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–±—É–µ–º –ø—Ä—è–º–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ..."
    sudo docker stop 3x-ui 2>/dev/null || true
    sudo docker rm 3x-ui 2>/dev/null || true
fi

# 2. –£–¥–∞–ª—è–µ–º –ø–∞–ø–∫—É —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏
echo "--- [2/5] –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ –∫–æ–Ω—Ñ–∏–≥–æ–≤..."
sudo rm -rf ~/3x-ui

# 3. –£–¥–∞–ª—è–µ–º —Ñ–∞–π–ª —Å —Å–µ–∫—Ä–µ—Ç–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ (—Å–æ–∑–¥–∞–Ω–Ω—ã–π –≤ –ø—Ä–æ—à–ª–æ–º —à–∞–≥–µ)
echo "--- [3/5] –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ —Å –ø–∞—Ä–æ–ª—è–º–∏..."
sudo rm -f /root/.3xui_credentials

# 4. –£–¥–∞–ª—è–µ–º Docker-—Å–µ—Ç—å
echo "--- [4/5] –û—á–∏—Å—Ç–∫–∞ —Å–µ—Ç–∏..."
sudo docker network rm shared-network 2>/dev/null || true

# 5. –û—á–∏—Å—Ç–∫–∞ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –æ–±—Ä–∞–∑–æ–≤ (—á—Ç–æ–±—ã –Ω–µ –∑–∞–±–∏–≤–∞—Ç—å –º–µ—Å—Ç–æ)
echo "--- [5/5] –£–¥–∞–ª–µ–Ω–∏–µ –æ–±—Ä–∞–∑–æ–≤ Docker..."
sudo docker image rm ghcr.io/mhsanaei/3x-ui:latest 2>/dev/null || true

echo "=========================================="
echo "‚úÖ –°–ò–°–¢–ï–ú–ê –û–ß–ò–©–ï–ù–ê"
echo "–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –∑–∞–Ω–æ–≤–æ –∑–∞–ø—É—Å–∫–∞—Ç—å install_3xui.sh"
echo "=========================================="